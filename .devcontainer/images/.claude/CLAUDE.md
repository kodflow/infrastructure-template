<!-- updated: 2026-02-19T15:10:00Z -->
# Claude Code Core Rules

## 1.0 MCP-FIRST (MANDATORY)

Use MCP tools BEFORE CLI fallbacks:
- `mcp__grepai__*` before Grep
- `mcp__github__*` before `gh`
- `mcp__codacy__*` before codacy-cli
- `mcp__playwright__*` before npx playwright

MCP has pre-configured auth. NEVER ask for tokens if MCP is configured.

## 2.0 GREPAI-FIRST (MANDATORY)

| Need | Tool |
|------|------|
| Semantic search | `grepai_search` |
| Find callers | `grepai_trace_callers` |
| Exact string | Grep (fallback) |
| Regex pattern | Grep (fallback) |

Fallback to Grep only if: grepai returns 0 results, exact match needed, or MCP unavailable.

## 3.0 ZSH-FIRST (MANDATORY)

Default shell is **zsh** (`chsh -s /bin/zsh` in Dockerfile). Claude Code's Bash tool uses `$SHELL`.

| Pattern | Status | Alternative |
|---------|--------|-------------|
| `for x in $VAR` | **BROKEN** | `while IFS= read -r x` |
| `for x in literal1 literal2` | OK | Literal lists work |
| `echo "$var" \| while read` | OK | Pipe to while |
| `while read < <(cmd)` | OK | Process substitution |

Shell scripts with `#!/bin/bash` shebang run in bash (OK).
Inline Bash tool commands run in zsh (must be compatible).

## 4.0 NO AI IN COMMITS

Forbidden: `Co-Authored-By: Claude/AI`, `Generated by AI`, robot emoji.
Enforced by `commit-validate.sh` hook.

## 5.0 SKILLS

| Skill | Purpose |
|-------|---------|
| `/init` | Personalize + validate |
| `/plan` | Planning mode |
| `/do` | Iterative task execution |
| `/review` | Code review (5 agents) |
| `/git` | Branch + commit + PR |
| `/search` | Documentation research |
| `/docs` | Deep project docs generation |
| `/test` | E2E testing (Playwright) |
| `/lint` | Intelligent linting (ktn-linter) |
| `/infra` | Infrastructure (Terraform) |
| `/secret` | Secure secrets (1Password) |
| `/vpn` | VPN management |
| `/warmup` | Context pre-loading |
| `/update` | DevContainer update |
| `/improve` | Docs QA |
| `/prompt` | Better /plan descriptions |

## 6.0 CONTEXT HIERARCHY

```
/workspace/CLAUDE.md         # Project (primary)
├── .devcontainer/CLAUDE.md  # Container
│   └── images/.claude/CLAUDE.md  # THIS FILE
└── src/CLAUDE.md            # Source
```

Each file < 100 lines. Read at session start.

## 7.0 GIT WORKFLOW

Never commit to main directly. Use `/git --commit` which:
1. Creates branch
2. Commits with conventional format
3. Opens PR

## 8.0 SAFEGUARDS

Ask before deleting: `.claude/`, `.devcontainer/`, commands, scripts, agents.
When refactoring: move content, never delete logic.

## 9.0 CONTEXT RECOVERY

On session start, check `/workspace/.claude/logs/<branch>/checkpoint.json`.
If interrupted task found, resume from last action.

## Quick Check

Before any action: MCP available? Tokens in env? On feature branch? CLAUDE.md read?
